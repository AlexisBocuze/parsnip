<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Regression Example • parsnip</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="../../tidyverse.css" rel="stylesheet">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><link href="../../tidyverse-2.css" rel="stylesheet">
<meta property="og:title" content="Regression Example">
<meta property="og:description" content="parsnip">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../../index.html">parsnip</a>
        <div class="info">
          <span class="partof">part of <a href="https://github.com/tidymodels">tidymodels</a></span>
          <span class="version version-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../../articles/parsnip_Intro.html">Basic Usage</a>
</li>
<li>
  <a href="../../articles/articles/Models.html">Model List</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/articles/Regression.html">Regression modeling</a>
    </li>
    <li>
      <a href="../../articles/articles/Classification.html">Classification modeling</a>
    </li>
    <li>
      <a href="../../articles/articles/Scratch.html">Making a parsnip model from scratch</a>
    </li>
    <li>
      <a href="../../articles/articles/Submodels.html">Evaluating submodels with the same model object</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../news/index.html">News</a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
        <li>
  <a href="https://github.com/tidymodels/parsnip/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Regression_files/header-attrs-2.1/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Regression Example</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tidymodels/parsnip/blob/master/vignettes/articles/Regression.Rmd"><code>vignettes/articles/Regression.Rmd</code></a></small>
      <div class="hidden name"><code>Regression.Rmd</code></div>

    </div>

    
    
<p>The Ames housing data will be used to to demonstrate how regression models can be made using <code>parsnip</code>. We’ll create the data set and create a simple training/test set split:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(AmesHousing)</span>
<span id="cb1-2"><a href="#cb1-2"></a>ames &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/AmesHousing/man/make_ames.html">make_ames</a></span>()</span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(tidymodels)</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="co">#&gt; ── Attaching packages ───────────────────────────────────────────────────────── tidymodels 0.1.0 ──</span></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="co">#&gt; ✓ broom     0.5.4      ✓ rsample   0.0.6 </span></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="co">#&gt; ✓ dials     0.0.6      ✓ tibble    3.0.0 </span></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="co">#&gt; ✓ dplyr     0.8.5      ✓ tune      0.1.0 </span></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="co">#&gt; ✓ infer     0.5.1      ✓ workflows 0.1.0 </span></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="co">#&gt; ✓ purrr     0.3.3      ✓ yardstick 0.0.5 </span></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="co">#&gt; ✓ recipes   0.1.10</span></span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="co">#&gt; ── Conflicts ──────────────────────────────────────────────────────────── tidymodels_conflicts() ──</span></span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="co">#&gt; x dplyr::combine() masks randomForest::combine()</span></span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="co">#&gt; x purrr::discard() masks scales::discard()</span></span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="co">#&gt; x dplyr::filter()  masks stats::filter()</span></span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="co">#&gt; x dplyr::lag()     masks stats::lag()</span></span>
<span id="cb1-17"><a href="#cb1-17"></a><span class="co">#&gt; x dials::margin()  masks ggplot2::margin(), randomForest::margin()</span></span>
<span id="cb1-18"><a href="#cb1-18"></a><span class="co">#&gt; x recipes::step()  masks stats::step()</span></span>
<span id="cb1-19"><a href="#cb1-19"></a></span>
<span id="cb1-20"><a href="#cb1-20"></a><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">4595</span>)</span>
<span id="cb1-21"><a href="#cb1-21"></a>data_split &lt;-<span class="st"> </span><span class="kw">initial_split</span>(ames, <span class="dt">strata =</span> <span class="st">"Sale_Price"</span>, <span class="dt">p =</span> <span class="fl">0.75</span>)</span>
<span id="cb1-22"><a href="#cb1-22"></a></span>
<span id="cb1-23"><a href="#cb1-23"></a>ames_train &lt;-<span class="st"> </span><span class="kw">training</span>(data_split)</span>
<span id="cb1-24"><a href="#cb1-24"></a>ames_test  &lt;-<span class="st"> </span><span class="kw">testing</span>(data_split)</span></code></pre></div>
<div id="random-forests" class="section level1">
<h1 class="hasAnchor">
<a href="#random-forests" class="anchor"></a>Random Forests</h1>
<p>We’ll start by fitting a random forest model to a small set of parameters. Let’s say that the model would include predictors: <code>Longitude</code>, <code>Latitude</code>, <code>Lot_Area</code>, <code>Neighborhood</code>, and <code>Year_Sold</code>. A simple random forest model can be specified via</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(parsnip)</span>
<span id="cb2-2"><a href="#cb2-2"></a></span>
<span id="cb2-3"><a href="#cb2-3"></a>rf_defaults &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/rand_forest.html">rand_forest</a></span>(<span class="dt">mode =</span> <span class="st">"regression"</span>)</span>
<span id="cb2-4"><a href="#cb2-4"></a>rf_defaults</span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="co">#&gt; Random Forest Model Specification (regression)</span></span></code></pre></div>
<p>The model will be fit with the <code>ranger</code> package. Since we didn’t add any extra arguments to <code>fit</code>, <em>many</em> of the arguments will be set to their defaults from the specific function that is used by <code><a href="https://rdrr.io/pkg/ranger/man/ranger.html">ranger::ranger</a></code>. The help pages for the model function describes the changes to the default parameters that are made and the <code>translate</code> function can also be used.</p>
<p><code>parsnip</code> gives two different interfaces to the models: the formula and non-formula interfaces. Let’s start with the non-formula interface:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>preds &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Longitude"</span>, <span class="st">"Latitude"</span>, <span class="st">"Lot_Area"</span>, <span class="st">"Neighborhood"</span>, <span class="st">"Year_Sold"</span>)</span>
<span id="cb3-2"><a href="#cb3-2"></a></span>
<span id="cb3-3"><a href="#cb3-3"></a>rf_xy_fit &lt;-<span class="st"> </span></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="st">  </span>rf_defaults <span class="op">%&gt;%</span></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="st">  </span><span class="kw"><a href="../../reference/set_engine.html">set_engine</a></span>(<span class="st">"ranger"</span>) <span class="op">%&gt;%</span></span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="st">  </span><span class="kw"><a href="https://rdrr.io/pkg/generics/man/fit_xy.html">fit_xy</a></span>(</span>
<span id="cb3-7"><a href="#cb3-7"></a>    <span class="dt">x =</span> ames_train[, preds],</span>
<span id="cb3-8"><a href="#cb3-8"></a>    <span class="dt">y =</span> <span class="kw"><a href="https://rdrr.io/r/base/Log.html">log10</a></span>(ames_train<span class="op">$</span>Sale_Price)</span>
<span id="cb3-9"><a href="#cb3-9"></a>  )</span>
<span id="cb3-10"><a href="#cb3-10"></a>rf_xy_fit</span>
<span id="cb3-11"><a href="#cb3-11"></a><span class="co">#&gt; parsnip model object</span></span>
<span id="cb3-12"><a href="#cb3-12"></a><span class="co">#&gt; </span></span>
<span id="cb3-13"><a href="#cb3-13"></a><span class="co">#&gt; Fit time:  927ms </span></span>
<span id="cb3-14"><a href="#cb3-14"></a><span class="co">#&gt; Ranger result</span></span>
<span id="cb3-15"><a href="#cb3-15"></a><span class="co">#&gt; </span></span>
<span id="cb3-16"><a href="#cb3-16"></a><span class="co">#&gt; Call:</span></span>
<span id="cb3-17"><a href="#cb3-17"></a><span class="co">#&gt;  ranger::ranger(formula = formula, data = data, num.threads = 1,      verbose = FALSE, seed = sample.int(10^5, 1)) </span></span>
<span id="cb3-18"><a href="#cb3-18"></a><span class="co">#&gt; </span></span>
<span id="cb3-19"><a href="#cb3-19"></a><span class="co">#&gt; Type:                             Regression </span></span>
<span id="cb3-20"><a href="#cb3-20"></a><span class="co">#&gt; Number of trees:                  500 </span></span>
<span id="cb3-21"><a href="#cb3-21"></a><span class="co">#&gt; Sample size:                      2199 </span></span>
<span id="cb3-22"><a href="#cb3-22"></a><span class="co">#&gt; Number of independent variables:  5 </span></span>
<span id="cb3-23"><a href="#cb3-23"></a><span class="co">#&gt; Mtry:                             2 </span></span>
<span id="cb3-24"><a href="#cb3-24"></a><span class="co">#&gt; Target node size:                 5 </span></span>
<span id="cb3-25"><a href="#cb3-25"></a><span class="co">#&gt; Variable importance mode:         none </span></span>
<span id="cb3-26"><a href="#cb3-26"></a><span class="co">#&gt; Splitrule:                        variance </span></span>
<span id="cb3-27"><a href="#cb3-27"></a><span class="co">#&gt; OOB prediction error (MSE):       0.00844 </span></span>
<span id="cb3-28"><a href="#cb3-28"></a><span class="co">#&gt; R squared (OOB):                  0.736</span></span></code></pre></div>
<p>The non-formula interface doesn’t do anything to the predictors before giving it to the underlying model function. This particular model does <em>not</em> require indicator variables to be create prior to the model (note that the output shows “Number of independent variables: 5”).</p>
<p>For regression models, the basic <code>predict</code> method can be used and returns a tibble with a column named <code>.pred</code>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>test_results &lt;-<span class="st"> </span>ames_test <span class="op">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="st">  </span><span class="kw">select</span>(Sale_Price) <span class="op">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Sale_Price =</span> <span class="kw"><a href="https://rdrr.io/r/base/Log.html">log10</a></span>(Sale_Price)) <span class="op">%&gt;%</span></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="st">  </span><span class="kw">bind_cols</span>(</span>
<span id="cb4-5"><a href="#cb4-5"></a>    <span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(rf_xy_fit, <span class="dt">new_data =</span> ames_test[, preds])</span>
<span id="cb4-6"><a href="#cb4-6"></a>  )</span>
<span id="cb4-7"><a href="#cb4-7"></a>test_results</span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="co">#&gt; # A tibble: 731 x 2</span></span>
<span id="cb4-9"><a href="#cb4-9"></a><span class="co">#&gt;    Sale_Price .pred</span></span>
<span id="cb4-10"><a href="#cb4-10"></a><span class="co">#&gt;         &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb4-11"><a href="#cb4-11"></a><span class="co">#&gt;  1       5.33  5.22</span></span>
<span id="cb4-12"><a href="#cb4-12"></a><span class="co">#&gt;  2       5.02  5.21</span></span>
<span id="cb4-13"><a href="#cb4-13"></a><span class="co">#&gt;  3       5.27  5.25</span></span>
<span id="cb4-14"><a href="#cb4-14"></a><span class="co">#&gt;  4       5.60  5.51</span></span>
<span id="cb4-15"><a href="#cb4-15"></a><span class="co">#&gt;  5       5.28  5.24</span></span>
<span id="cb4-16"><a href="#cb4-16"></a><span class="co">#&gt;  6       5.17  5.19</span></span>
<span id="cb4-17"><a href="#cb4-17"></a><span class="co">#&gt;  7       5.02  4.97</span></span>
<span id="cb4-18"><a href="#cb4-18"></a><span class="co">#&gt;  8       5.46  5.50</span></span>
<span id="cb4-19"><a href="#cb4-19"></a><span class="co">#&gt;  9       5.44  5.46</span></span>
<span id="cb4-20"><a href="#cb4-20"></a><span class="co">#&gt; 10       5.33  5.50</span></span>
<span id="cb4-21"><a href="#cb4-21"></a><span class="co">#&gt; # … with 721 more rows</span></span>
<span id="cb4-22"><a href="#cb4-22"></a></span>
<span id="cb4-23"><a href="#cb4-23"></a><span class="co"># summarize performance</span></span>
<span id="cb4-24"><a href="#cb4-24"></a>test_results <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">metrics</span>(<span class="dt">truth =</span> Sale_Price, <span class="dt">estimate =</span> .pred) </span>
<span id="cb4-25"><a href="#cb4-25"></a><span class="co">#&gt; # A tibble: 3 x 3</span></span>
<span id="cb4-26"><a href="#cb4-26"></a><span class="co">#&gt;   .metric .estimator .estimate</span></span>
<span id="cb4-27"><a href="#cb4-27"></a><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;</span></span>
<span id="cb4-28"><a href="#cb4-28"></a><span class="co">#&gt; 1 rmse    standard      0.0914</span></span>
<span id="cb4-29"><a href="#cb4-29"></a><span class="co">#&gt; 2 rsq     standard      0.717 </span></span>
<span id="cb4-30"><a href="#cb4-30"></a><span class="co">#&gt; 3 mae     standard      0.0662</span></span></code></pre></div>
<p>Note that:</p>
<ul>
<li>If the model required indicator variables, we would have to create them manually prior to using <code>fit</code> (perhaps using the <code>recipes</code> package).</li>
<li>We had to manually log the outcome prior to modeling.</li>
</ul>
<p>Now, for illustration, let’s use the formula method using some new parameter values:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw"><a href="../../reference/rand_forest.html">rand_forest</a></span>(<span class="dt">mode =</span> <span class="st">"regression"</span>, <span class="dt">mtry =</span> <span class="dv">3</span>, <span class="dt">trees =</span> <span class="dv">1000</span>) <span class="op">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="st">  </span><span class="kw"><a href="../../reference/set_engine.html">set_engine</a></span>(<span class="st">"ranger"</span>) <span class="op">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="st">  </span><span class="kw"><a href="https://rdrr.io/pkg/generics/man/fit.html">fit</a></span>(</span>
<span id="cb5-4"><a href="#cb5-4"></a>    <span class="kw"><a href="https://rdrr.io/r/base/Log.html">log10</a></span>(Sale_Price) <span class="op">~</span><span class="st"> </span>Longitude <span class="op">+</span><span class="st"> </span>Latitude <span class="op">+</span><span class="st"> </span>Lot_Area <span class="op">+</span><span class="st"> </span>Neighborhood <span class="op">+</span><span class="st"> </span>Year_Sold,</span>
<span id="cb5-5"><a href="#cb5-5"></a>    <span class="dt">data =</span> ames_train</span>
<span id="cb5-6"><a href="#cb5-6"></a>  )</span>
<span id="cb5-7"><a href="#cb5-7"></a><span class="co">#&gt; parsnip model object</span></span>
<span id="cb5-8"><a href="#cb5-8"></a><span class="co">#&gt; </span></span>
<span id="cb5-9"><a href="#cb5-9"></a><span class="co">#&gt; Fit time:  2.6s </span></span>
<span id="cb5-10"><a href="#cb5-10"></a><span class="co">#&gt; Ranger result</span></span>
<span id="cb5-11"><a href="#cb5-11"></a><span class="co">#&gt; </span></span>
<span id="cb5-12"><a href="#cb5-12"></a><span class="co">#&gt; Call:</span></span>
<span id="cb5-13"><a href="#cb5-13"></a><span class="co">#&gt;  ranger::ranger(formula = formula, data = data, mtry = ~3, num.trees = ~1000,      num.threads = 1, verbose = FALSE, seed = sample.int(10^5,          1)) </span></span>
<span id="cb5-14"><a href="#cb5-14"></a><span class="co">#&gt; </span></span>
<span id="cb5-15"><a href="#cb5-15"></a><span class="co">#&gt; Type:                             Regression </span></span>
<span id="cb5-16"><a href="#cb5-16"></a><span class="co">#&gt; Number of trees:                  1000 </span></span>
<span id="cb5-17"><a href="#cb5-17"></a><span class="co">#&gt; Sample size:                      2199 </span></span>
<span id="cb5-18"><a href="#cb5-18"></a><span class="co">#&gt; Number of independent variables:  5 </span></span>
<span id="cb5-19"><a href="#cb5-19"></a><span class="co">#&gt; Mtry:                             3 </span></span>
<span id="cb5-20"><a href="#cb5-20"></a><span class="co">#&gt; Target node size:                 5 </span></span>
<span id="cb5-21"><a href="#cb5-21"></a><span class="co">#&gt; Variable importance mode:         none </span></span>
<span id="cb5-22"><a href="#cb5-22"></a><span class="co">#&gt; Splitrule:                        variance </span></span>
<span id="cb5-23"><a href="#cb5-23"></a><span class="co">#&gt; OOB prediction error (MSE):       0.00848 </span></span>
<span id="cb5-24"><a href="#cb5-24"></a><span class="co">#&gt; R squared (OOB):                  0.735</span></span></code></pre></div>
<p>Suppose that there was some feature in the <code>randomForest</code> package that we’d like to evaluate. To do so, the only part of the syntaxt that needs to change is the <code>set_engine</code> argument:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="kw"><a href="../../reference/rand_forest.html">rand_forest</a></span>(<span class="dt">mode =</span> <span class="st">"regression"</span>, <span class="dt">mtry =</span> <span class="dv">3</span>, <span class="dt">trees =</span> <span class="dv">1000</span>) <span class="op">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="st">  </span><span class="kw"><a href="../../reference/set_engine.html">set_engine</a></span>(<span class="st">"randomForest"</span>) <span class="op">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="st">  </span><span class="kw"><a href="https://rdrr.io/pkg/generics/man/fit.html">fit</a></span>(</span>
<span id="cb6-4"><a href="#cb6-4"></a>    <span class="kw"><a href="https://rdrr.io/r/base/Log.html">log10</a></span>(Sale_Price) <span class="op">~</span><span class="st"> </span>Longitude <span class="op">+</span><span class="st"> </span>Latitude <span class="op">+</span><span class="st"> </span>Lot_Area <span class="op">+</span><span class="st"> </span>Neighborhood <span class="op">+</span><span class="st"> </span>Year_Sold,</span>
<span id="cb6-5"><a href="#cb6-5"></a>    <span class="dt">data =</span> ames_train</span>
<span id="cb6-6"><a href="#cb6-6"></a>  )</span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="co">#&gt; parsnip model object</span></span>
<span id="cb6-8"><a href="#cb6-8"></a><span class="co">#&gt; </span></span>
<span id="cb6-9"><a href="#cb6-9"></a><span class="co">#&gt; Fit time:  1.9s </span></span>
<span id="cb6-10"><a href="#cb6-10"></a><span class="co">#&gt; </span></span>
<span id="cb6-11"><a href="#cb6-11"></a><span class="co">#&gt; Call:</span></span>
<span id="cb6-12"><a href="#cb6-12"></a><span class="co">#&gt;  randomForest(x = as.data.frame(x), y = y, ntree = ~1000, mtry = ~3) </span></span>
<span id="cb6-13"><a href="#cb6-13"></a><span class="co">#&gt;                Type of random forest: regression</span></span>
<span id="cb6-14"><a href="#cb6-14"></a><span class="co">#&gt;                      Number of trees: 1000</span></span>
<span id="cb6-15"><a href="#cb6-15"></a><span class="co">#&gt; No. of variables tried at each split: 3</span></span>
<span id="cb6-16"><a href="#cb6-16"></a><span class="co">#&gt; </span></span>
<span id="cb6-17"><a href="#cb6-17"></a><span class="co">#&gt;           Mean of squared residuals: 0.013</span></span>
<span id="cb6-18"><a href="#cb6-18"></a><span class="co">#&gt;                     % Var explained: 59.4</span></span></code></pre></div>
<p>Look at the formula code that was printed out, one function uses the argument name <code>ntree</code> and the other uses <code>num.trees</code>. <code>parsnip</code> doesn’t require you to know the specific names of the main arguments.</p>
<p>Now suppose that we want to modify the value of <code>mtry</code> based on the number of predictors in the data. Usually, the default value would be <code><a href="https://rdrr.io/r/base/Round.html">floor(sqrt(num_predictors))</a></code>. To use a pure bagging model would require an <code>mtry</code> value equal to the total number of parameters. There may be cases where you may not know how many predictors are going to be present (perhaps due to the generation of indicator variables or a variable filter) so that might be difficult to know exactly.</p>
<p>When the model it being fit by <code>parsnip</code>, <a href="https://topepo.github.io/parsnip/reference/descriptors.html"><em>data descriptors</em></a> are made available. These attempt to let you know what you will have available when the model is fit. When a model object is created (say using <code>rand_forest</code>), the values of the arguments that you give it are <em>immediately evaluated</em>… unless you delay them. To delay the evaluation of any argument, you can used <code><a href="https://rlang.r-lib.org/reference/nse-defuse.html">rlang::expr</a></code> to make an expression.</p>
<p>Two relevant descriptors for what we are about to do are:</p>
<ul>
<li>
<code><a href="../../reference/descriptors.html">.preds()</a></code>: the number of predictor <em>variables</em> in the data set that are associated with the predictors <strong>prior to dummy variable creation</strong>.</li>
<li>
<code><a href="../../reference/descriptors.html">.cols()</a></code>: the number of predictor <em>columns</em> after dummy variables (or other encodings) are created.</li>
</ul>
<p>Since <code>ranger</code> won’t create indicator values, <code><a href="../../reference/descriptors.html">.preds()</a></code> would be appropriate for using <code>mtry</code> for a bagging model.</p>
<p>For example, let’s use an expression with the <code><a href="../../reference/descriptors.html">.preds()</a></code> descriptor to fit a bagging model:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="kw"><a href="../../reference/rand_forest.html">rand_forest</a></span>(<span class="dt">mode =</span> <span class="st">"regression"</span>, <span class="dt">mtry =</span> <span class="kw"><a href="../../reference/descriptors.html">.preds</a></span>(), <span class="dt">trees =</span> <span class="dv">1000</span>) <span class="op">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="st">  </span><span class="kw"><a href="../../reference/set_engine.html">set_engine</a></span>(<span class="st">"ranger"</span>) <span class="op">%&gt;%</span></span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="st">  </span><span class="kw"><a href="https://rdrr.io/pkg/generics/man/fit.html">fit</a></span>(</span>
<span id="cb7-4"><a href="#cb7-4"></a>    <span class="kw"><a href="https://rdrr.io/r/base/Log.html">log10</a></span>(Sale_Price) <span class="op">~</span><span class="st"> </span>Longitude <span class="op">+</span><span class="st"> </span>Latitude <span class="op">+</span><span class="st"> </span>Lot_Area <span class="op">+</span><span class="st"> </span>Neighborhood <span class="op">+</span><span class="st"> </span>Year_Sold,</span>
<span id="cb7-5"><a href="#cb7-5"></a>    <span class="dt">data =</span> ames_train</span>
<span id="cb7-6"><a href="#cb7-6"></a>  )</span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="co">#&gt; parsnip model object</span></span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="co">#&gt; </span></span>
<span id="cb7-9"><a href="#cb7-9"></a><span class="co">#&gt; Fit time:  3.5s </span></span>
<span id="cb7-10"><a href="#cb7-10"></a><span class="co">#&gt; Ranger result</span></span>
<span id="cb7-11"><a href="#cb7-11"></a><span class="co">#&gt; </span></span>
<span id="cb7-12"><a href="#cb7-12"></a><span class="co">#&gt; Call:</span></span>
<span id="cb7-13"><a href="#cb7-13"></a><span class="co">#&gt;  ranger::ranger(formula = formula, data = data, mtry = ~.preds(),      num.trees = ~1000, num.threads = 1, verbose = FALSE, seed = sample.int(10^5,          1)) </span></span>
<span id="cb7-14"><a href="#cb7-14"></a><span class="co">#&gt; </span></span>
<span id="cb7-15"><a href="#cb7-15"></a><span class="co">#&gt; Type:                             Regression </span></span>
<span id="cb7-16"><a href="#cb7-16"></a><span class="co">#&gt; Number of trees:                  1000 </span></span>
<span id="cb7-17"><a href="#cb7-17"></a><span class="co">#&gt; Sample size:                      2199 </span></span>
<span id="cb7-18"><a href="#cb7-18"></a><span class="co">#&gt; Number of independent variables:  5 </span></span>
<span id="cb7-19"><a href="#cb7-19"></a><span class="co">#&gt; Mtry:                             5 </span></span>
<span id="cb7-20"><a href="#cb7-20"></a><span class="co">#&gt; Target node size:                 5 </span></span>
<span id="cb7-21"><a href="#cb7-21"></a><span class="co">#&gt; Variable importance mode:         none </span></span>
<span id="cb7-22"><a href="#cb7-22"></a><span class="co">#&gt; Splitrule:                        variance </span></span>
<span id="cb7-23"><a href="#cb7-23"></a><span class="co">#&gt; OOB prediction error (MSE):       0.00869 </span></span>
<span id="cb7-24"><a href="#cb7-24"></a><span class="co">#&gt; R squared (OOB):                  0.728</span></span></code></pre></div>
</div>
<div id="penalized-linear-regression" class="section level1">
<h1 class="hasAnchor">
<a href="#penalized-linear-regression" class="anchor"></a>Penalized Linear Regression</h1>
<p>A linear model might work here too. The <code>linear_reg</code> model can be used. To use regularization/penalization, there are two engines that can do that here: the <code>glmnet</code> and <code>sparklyr</code> packages. The former will be used here and it only implements the non-formula method. <code>parsnip</code> will allow either to be used though.</p>
<p>When regularization is used, the predictors should first be centered and scaled before given to the model. The formula method won’t do that so some other methods will be required. We’ll use <code>recipes</code> package for that (more information <a href="https://tidymodels.github.io/recipes/">here</a>).</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>norm_recipe &lt;-<span class="st"> </span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="st">  </span><span class="kw">recipe</span>(</span>
<span id="cb8-3"><a href="#cb8-3"></a>    Sale_Price <span class="op">~</span><span class="st"> </span>Longitude <span class="op">+</span><span class="st"> </span>Latitude <span class="op">+</span><span class="st"> </span>Lot_Area <span class="op">+</span><span class="st"> </span>Neighborhood <span class="op">+</span><span class="st"> </span>Year_Sold, </span>
<span id="cb8-4"><a href="#cb8-4"></a>    <span class="dt">data =</span> ames_train</span>
<span id="cb8-5"><a href="#cb8-5"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb8-6"><a href="#cb8-6"></a><span class="st">  </span><span class="kw">step_other</span>(Neighborhood) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb8-7"><a href="#cb8-7"></a><span class="st">  </span><span class="kw">step_dummy</span>(<span class="kw">all_nominal</span>()) <span class="op">%&gt;%</span></span>
<span id="cb8-8"><a href="#cb8-8"></a><span class="st">  </span><span class="kw">step_center</span>(<span class="kw">all_predictors</span>()) <span class="op">%&gt;%</span></span>
<span id="cb8-9"><a href="#cb8-9"></a><span class="st">  </span><span class="kw">step_scale</span>(<span class="kw">all_predictors</span>()) <span class="op">%&gt;%</span></span>
<span id="cb8-10"><a href="#cb8-10"></a><span class="st">  </span><span class="kw">step_log</span>(Sale_Price, <span class="dt">base =</span> <span class="dv">10</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb8-11"><a href="#cb8-11"></a><span class="st">  </span><span class="co"># estimate the means and standard deviations</span></span>
<span id="cb8-12"><a href="#cb8-12"></a><span class="st">  </span><span class="kw">prep</span>(<span class="dt">training =</span> ames_train, <span class="dt">retain =</span> <span class="ot">TRUE</span>)</span>
<span id="cb8-13"><a href="#cb8-13"></a></span>
<span id="cb8-14"><a href="#cb8-14"></a><span class="co"># Now let's fit the model using the processed version of the data</span></span>
<span id="cb8-15"><a href="#cb8-15"></a></span>
<span id="cb8-16"><a href="#cb8-16"></a>glmn_fit &lt;-<span class="st"> </span></span>
<span id="cb8-17"><a href="#cb8-17"></a><span class="st">  </span><span class="kw"><a href="../../reference/linear_reg.html">linear_reg</a></span>(<span class="dt">penalty =</span> <span class="fl">0.001</span>, <span class="dt">mixture =</span> <span class="fl">0.5</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb8-18"><a href="#cb8-18"></a><span class="st">  </span><span class="kw"><a href="../../reference/set_engine.html">set_engine</a></span>(<span class="st">"glmnet"</span>) <span class="op">%&gt;%</span></span>
<span id="cb8-19"><a href="#cb8-19"></a><span class="st">  </span><span class="kw"><a href="https://rdrr.io/pkg/generics/man/fit.html">fit</a></span>(Sale_Price <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> <span class="kw">juice</span>(norm_recipe))</span>
<span id="cb8-20"><a href="#cb8-20"></a>glmn_fit</span>
<span id="cb8-21"><a href="#cb8-21"></a><span class="co">#&gt; parsnip model object</span></span>
<span id="cb8-22"><a href="#cb8-22"></a><span class="co">#&gt; </span></span>
<span id="cb8-23"><a href="#cb8-23"></a><span class="co">#&gt; Fit time:  7ms </span></span>
<span id="cb8-24"><a href="#cb8-24"></a><span class="co">#&gt; </span></span>
<span id="cb8-25"><a href="#cb8-25"></a><span class="co">#&gt; Call:  glmnet::glmnet(x = as.matrix(x), y = y, family = "gaussian",      alpha = ~0.5) </span></span>
<span id="cb8-26"><a href="#cb8-26"></a><span class="co">#&gt; </span></span>
<span id="cb8-27"><a href="#cb8-27"></a><span class="co">#&gt;    Df  %Dev Lambda</span></span>
<span id="cb8-28"><a href="#cb8-28"></a><span class="co">#&gt; 1   0 0.000 0.1370</span></span>
<span id="cb8-29"><a href="#cb8-29"></a><span class="co">#&gt; 2   1 0.019 0.1250</span></span>
<span id="cb8-30"><a href="#cb8-30"></a><span class="co">#&gt; 3   1 0.036 0.1140</span></span>
<span id="cb8-31"><a href="#cb8-31"></a><span class="co">#&gt; 4   1 0.050 0.1040</span></span>
<span id="cb8-32"><a href="#cb8-32"></a><span class="co">#&gt; 5   2 0.068 0.0946</span></span>
<span id="cb8-33"><a href="#cb8-33"></a><span class="co">#&gt; 6   4 0.093 0.0862</span></span>
<span id="cb8-34"><a href="#cb8-34"></a><span class="co">#&gt; 7   5 0.125 0.0785</span></span>
<span id="cb8-35"><a href="#cb8-35"></a><span class="co">#&gt; 8   5 0.153 0.0716</span></span>
<span id="cb8-36"><a href="#cb8-36"></a><span class="co">#&gt; 9   7 0.184 0.0652</span></span>
<span id="cb8-37"><a href="#cb8-37"></a><span class="co">#&gt; 10  7 0.214 0.0594</span></span>
<span id="cb8-38"><a href="#cb8-38"></a><span class="co">#&gt; 11  7 0.240 0.0541</span></span>
<span id="cb8-39"><a href="#cb8-39"></a><span class="co">#&gt; 12  8 0.262 0.0493</span></span>
<span id="cb8-40"><a href="#cb8-40"></a><span class="co">#&gt; 13  8 0.286 0.0449</span></span>
<span id="cb8-41"><a href="#cb8-41"></a><span class="co">#&gt; 14  8 0.306 0.0409</span></span>
<span id="cb8-42"><a href="#cb8-42"></a><span class="co">#&gt; 15  8 0.323 0.0373</span></span>
<span id="cb8-43"><a href="#cb8-43"></a><span class="co">#&gt; 16  8 0.338 0.0340</span></span>
<span id="cb8-44"><a href="#cb8-44"></a><span class="co">#&gt; 17  8 0.350 0.0310</span></span>
<span id="cb8-45"><a href="#cb8-45"></a><span class="co">#&gt; 18  8 0.361 0.0282</span></span>
<span id="cb8-46"><a href="#cb8-46"></a><span class="co">#&gt; 19  9 0.370 0.0257</span></span>
<span id="cb8-47"><a href="#cb8-47"></a><span class="co">#&gt; 20  9 0.379 0.0234</span></span>
<span id="cb8-48"><a href="#cb8-48"></a><span class="co">#&gt; 21  9 0.386 0.0213</span></span>
<span id="cb8-49"><a href="#cb8-49"></a><span class="co">#&gt; 22  9 0.392 0.0195</span></span>
<span id="cb8-50"><a href="#cb8-50"></a><span class="co">#&gt; 23  9 0.397 0.0177</span></span>
<span id="cb8-51"><a href="#cb8-51"></a><span class="co">#&gt; 24  9 0.401 0.0161</span></span>
<span id="cb8-52"><a href="#cb8-52"></a><span class="co">#&gt; 25  9 0.405 0.0147</span></span>
<span id="cb8-53"><a href="#cb8-53"></a><span class="co">#&gt; 26  9 0.408 0.0134</span></span>
<span id="cb8-54"><a href="#cb8-54"></a><span class="co">#&gt; 27 10 0.410 0.0122</span></span>
<span id="cb8-55"><a href="#cb8-55"></a><span class="co">#&gt; 28 11 0.413 0.0111</span></span>
<span id="cb8-56"><a href="#cb8-56"></a><span class="co">#&gt; 29 11 0.415 0.0101</span></span>
<span id="cb8-57"><a href="#cb8-57"></a><span class="co">#&gt; 30 11 0.417 0.0092</span></span>
<span id="cb8-58"><a href="#cb8-58"></a><span class="co">#&gt; 31 12 0.418 0.0084</span></span>
<span id="cb8-59"><a href="#cb8-59"></a><span class="co">#&gt; 32 12 0.420 0.0077</span></span>
<span id="cb8-60"><a href="#cb8-60"></a><span class="co">#&gt; 33 12 0.421 0.0070</span></span>
<span id="cb8-61"><a href="#cb8-61"></a><span class="co">#&gt; 34 12 0.422 0.0064</span></span>
<span id="cb8-62"><a href="#cb8-62"></a><span class="co">#&gt; 35 12 0.423 0.0058</span></span>
<span id="cb8-63"><a href="#cb8-63"></a><span class="co">#&gt; 36 12 0.423 0.0053</span></span>
<span id="cb8-64"><a href="#cb8-64"></a><span class="co">#&gt; 37 12 0.424 0.0048</span></span>
<span id="cb8-65"><a href="#cb8-65"></a><span class="co">#&gt; 38 12 0.425 0.0044</span></span>
<span id="cb8-66"><a href="#cb8-66"></a><span class="co">#&gt; 39 12 0.425 0.0040</span></span>
<span id="cb8-67"><a href="#cb8-67"></a><span class="co">#&gt; 40 12 0.425 0.0036</span></span>
<span id="cb8-68"><a href="#cb8-68"></a><span class="co">#&gt; 41 12 0.426 0.0033</span></span>
<span id="cb8-69"><a href="#cb8-69"></a><span class="co">#&gt; 42 12 0.426 0.0030</span></span>
<span id="cb8-70"><a href="#cb8-70"></a><span class="co">#&gt; 43 12 0.426 0.0028</span></span>
<span id="cb8-71"><a href="#cb8-71"></a><span class="co">#&gt; 44 12 0.426 0.0025</span></span>
<span id="cb8-72"><a href="#cb8-72"></a><span class="co">#&gt; 45 12 0.426 0.0023</span></span>
<span id="cb8-73"><a href="#cb8-73"></a><span class="co">#&gt; 46 12 0.426 0.0021</span></span>
<span id="cb8-74"><a href="#cb8-74"></a><span class="co">#&gt; 47 12 0.427 0.0019</span></span>
<span id="cb8-75"><a href="#cb8-75"></a><span class="co">#&gt; 48 12 0.427 0.0017</span></span>
<span id="cb8-76"><a href="#cb8-76"></a><span class="co">#&gt; 49 12 0.427 0.0016</span></span>
<span id="cb8-77"><a href="#cb8-77"></a><span class="co">#&gt; 50 12 0.427 0.0014</span></span>
<span id="cb8-78"><a href="#cb8-78"></a><span class="co">#&gt; 51 12 0.427 0.0013</span></span>
<span id="cb8-79"><a href="#cb8-79"></a><span class="co">#&gt; 52 12 0.427 0.0012</span></span>
<span id="cb8-80"><a href="#cb8-80"></a><span class="co">#&gt; 53 12 0.427 0.0011</span></span>
<span id="cb8-81"><a href="#cb8-81"></a><span class="co">#&gt; 54 12 0.427 0.0010</span></span>
<span id="cb8-82"><a href="#cb8-82"></a><span class="co">#&gt; 55 12 0.427 0.0009</span></span>
<span id="cb8-83"><a href="#cb8-83"></a><span class="co">#&gt; 56 12 0.427 0.0008</span></span>
<span id="cb8-84"><a href="#cb8-84"></a><span class="co">#&gt; 57 12 0.427 0.0008</span></span>
<span id="cb8-85"><a href="#cb8-85"></a><span class="co">#&gt; 58 12 0.427 0.0007</span></span>
<span id="cb8-86"><a href="#cb8-86"></a><span class="co">#&gt; 59 12 0.427 0.0006</span></span>
<span id="cb8-87"><a href="#cb8-87"></a><span class="co">#&gt; 60 12 0.427 0.0006</span></span>
<span id="cb8-88"><a href="#cb8-88"></a><span class="co">#&gt; 61 12 0.427 0.0005</span></span>
<span id="cb8-89"><a href="#cb8-89"></a><span class="co">#&gt; 62 12 0.427 0.0005</span></span>
<span id="cb8-90"><a href="#cb8-90"></a><span class="co">#&gt; 63 12 0.427 0.0004</span></span>
<span id="cb8-91"><a href="#cb8-91"></a><span class="co">#&gt; 64 12 0.427 0.0004</span></span>
<span id="cb8-92"><a href="#cb8-92"></a><span class="co">#&gt; 65 12 0.427 0.0004</span></span></code></pre></div>
<p>If <code>penalty</code> were not specified, all of the <code>lambda</code> values would be computed.</p>
<p>To get the predictions for this specific value of <code>lambda</code> (aka <code>penalty</code>):</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># First, get the processed version of the test set predictors:</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>test_normalized &lt;-<span class="st"> </span><span class="kw">bake</span>(norm_recipe, <span class="dt">new_data =</span> ames_test, <span class="kw">all_predictors</span>())</span>
<span id="cb9-3"><a href="#cb9-3"></a></span>
<span id="cb9-4"><a href="#cb9-4"></a>test_results &lt;-<span class="st"> </span></span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="st">  </span>test_results <span class="op">%&gt;%</span></span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="st">  </span><span class="kw">rename</span>(<span class="st">`</span><span class="dt">random forest</span><span class="st">`</span> =<span class="st"> </span>.pred) <span class="op">%&gt;%</span></span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="st">  </span><span class="kw">bind_cols</span>(</span>
<span id="cb9-8"><a href="#cb9-8"></a>    <span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(glmn_fit, <span class="dt">new_data =</span> test_normalized) <span class="op">%&gt;%</span></span>
<span id="cb9-9"><a href="#cb9-9"></a><span class="st">      </span><span class="kw">rename</span>(<span class="dt">glmnet =</span> .pred)</span>
<span id="cb9-10"><a href="#cb9-10"></a>  )</span>
<span id="cb9-11"><a href="#cb9-11"></a>test_results</span>
<span id="cb9-12"><a href="#cb9-12"></a><span class="co">#&gt; # A tibble: 731 x 3</span></span>
<span id="cb9-13"><a href="#cb9-13"></a><span class="co">#&gt;    Sale_Price `random forest` glmnet</span></span>
<span id="cb9-14"><a href="#cb9-14"></a><span class="co">#&gt;         &lt;dbl&gt;           &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb9-15"><a href="#cb9-15"></a><span class="co">#&gt;  1       5.33            5.22   5.27</span></span>
<span id="cb9-16"><a href="#cb9-16"></a><span class="co">#&gt;  2       5.02            5.21   5.17</span></span>
<span id="cb9-17"><a href="#cb9-17"></a><span class="co">#&gt;  3       5.27            5.25   5.23</span></span>
<span id="cb9-18"><a href="#cb9-18"></a><span class="co">#&gt;  4       5.60            5.51   5.25</span></span>
<span id="cb9-19"><a href="#cb9-19"></a><span class="co">#&gt;  5       5.28            5.24   5.25</span></span>
<span id="cb9-20"><a href="#cb9-20"></a><span class="co">#&gt;  6       5.17            5.19   5.19</span></span>
<span id="cb9-21"><a href="#cb9-21"></a><span class="co">#&gt;  7       5.02            4.97   5.19</span></span>
<span id="cb9-22"><a href="#cb9-22"></a><span class="co">#&gt;  8       5.46            5.50   5.49</span></span>
<span id="cb9-23"><a href="#cb9-23"></a><span class="co">#&gt;  9       5.44            5.46   5.48</span></span>
<span id="cb9-24"><a href="#cb9-24"></a><span class="co">#&gt; 10       5.33            5.50   5.47</span></span>
<span id="cb9-25"><a href="#cb9-25"></a><span class="co">#&gt; # … with 721 more rows</span></span>
<span id="cb9-26"><a href="#cb9-26"></a></span>
<span id="cb9-27"><a href="#cb9-27"></a>test_results <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">metrics</span>(<span class="dt">truth =</span> Sale_Price, <span class="dt">estimate =</span> glmnet) </span>
<span id="cb9-28"><a href="#cb9-28"></a><span class="co">#&gt; # A tibble: 3 x 3</span></span>
<span id="cb9-29"><a href="#cb9-29"></a><span class="co">#&gt;   .metric .estimator .estimate</span></span>
<span id="cb9-30"><a href="#cb9-30"></a><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;</span></span>
<span id="cb9-31"><a href="#cb9-31"></a><span class="co">#&gt; 1 rmse    standard      0.132 </span></span>
<span id="cb9-32"><a href="#cb9-32"></a><span class="co">#&gt; 2 rsq     standard      0.410 </span></span>
<span id="cb9-33"><a href="#cb9-33"></a><span class="co">#&gt; 3 mae     standard      0.0956</span></span>
<span id="cb9-34"><a href="#cb9-34"></a></span>
<span id="cb9-35"><a href="#cb9-35"></a>test_results <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb9-36"><a href="#cb9-36"></a><span class="st">  </span><span class="kw">gather</span>(model, prediction, <span class="op">-</span>Sale_Price) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb9-37"><a href="#cb9-37"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> prediction, <span class="dt">y =</span> Sale_Price)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb9-38"><a href="#cb9-38"></a><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">col =</span> <span class="st">"green"</span>, <span class="dt">lty =</span> <span class="dv">2</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb9-39"><a href="#cb9-39"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">.4</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb9-40"><a href="#cb9-40"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>model) <span class="op">+</span><span class="st"> </span></span>
<span id="cb9-41"><a href="#cb9-41"></a><span class="st">  </span><span class="kw">coord_fixed</span>()</span></code></pre></div>
<p><img src="Regression_files/figure-html/glmn-pred-1.png" width="768"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="tidyverse">
  <p><code>parsnip</code> is a part of the <strong>tidymodels</strong> ecosystem, a collection of modeling packages designed with common APIs and a shared philosophy.</p>
</div>

<div class="author">
  <p>
    Developed by Max Kuhn, Davis Vaughan.
    Site built by <a href="https://pkgdown.r-lib.org">pkgdown</a>.
  </p>
</div>

      </footer>
</div>

  


  </body>
</html>
